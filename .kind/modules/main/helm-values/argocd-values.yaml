# ArgoCD Helm Values
# Configuration for ArgoCD deployment with Gateway API HTTPRoute

global:
  # Domain configuration for accessing ArgoCD UI
  domain: argocd.${gateway_dns_suffix}
  logging:
    format: json

# Server configuration
server:
  # Service type for accessing ArgoCD UI
  service:
    type: ClusterIP

  # Ingress disabled - using Gateway API HTTPRoute
  ingress:
    enabled: false

  # HTTPRoute configuration for Gateway API
  httproute:
    enabled: true
    hostnames:
      - argocd.${gateway_dns_suffix}
    parentRefs:
      - name: management-gateway
        namespace: envoy-gateway-system
        sectionName: mgmt-https-listener

  # Server configuration
  extraArgs:
    - --insecure # Disable TLS for local development (TLS terminated at gateway)

  # Resource limits for local dev
  resources:
    limits: {}
    requests:
      cpu: 250m
      memory: 128Mi

# Redis configuration (used by ArgoCD for caching)
redis:
  enabled: true
  resources:
    limits: {}
    requests:
      cpu: 100m
      memory: 64Mi

# Repo server configuration
repoServer:
  resources:
    limits: {}
    requests:
      cpu: 250m
      memory: 256Mi

# Application controller configuration
controller:
  resources:
    limits: {}
    requests:
      cpu: 500m
      memory: 512Mi

# Dex (SSO) - disabled for local dev
dex:
  enabled: false

# Notifications controller - disabled for local dev
notifications:
  enabled: false

# ApplicationSet controller - enabled for advanced app deployment patterns
applicationSet:
  enabled: true
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

# Config management plugins - disabled for basic setup
configs:
  params:
    # Disable TLS for local development
    server.insecure: true
    # Enable exec provider for kubectl authentication
    server.rbac.log.enforce.enable: false
  
  # Repository credentials templates
  credentialTemplates: {}
  
  # Default repositories
  repositories:
    local-oci-registry:
      url: docker-registry.registry.svc.cluster.local:5000
      name: local-oci-registry
      type: helm
      enableOCI: "true"
      insecure: "true"

# RBAC configuration
rbac:
  # Default policy is role:readonly for all authenticated users
  policy.default: role:admin
  # Admin users
  policy.csv: |
    g, admin, role:admin

# Install CRDs
crds:
  install: true
  keep: true
