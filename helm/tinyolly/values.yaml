# Default values for tinyolly.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global settings
global:
  # -- Namespace for TinyOlly deployment
  namespace: tinyolly

# -- Number of replicas for each component (can be overridden per component)
replicaCount: 1

# Image settings
image:
  # -- Image pull policy
  pullPolicy: Always
  # -- Image pull secrets
  pullSecrets: []

# -- Labels to add to all resources
commonLabels: {}

# -- Annotations to add to all resources
commonAnnotations: {}

# Redis configuration (assumes redis-operator managed cluster)
redis:
  # -- Redis host (should match your redis-operator cluster name)
  host: tinyolly-redis
  # -- Redis port
  port: 6379

# DEPRECATED: Use gatewayCollector instead - this basic collector is redundant
# The gateway collector provides all the same features plus tail sampling,
# Envoy service name extraction, and spanmetrics generation.
# NOTE: OTel Operator creates service as {name}-collector, e.g., gateway-collector
otelCollector:
  enabled: false
  serviceName: gateway-collector
  port: 4318
  # When enabled, the OTel Operator creates service: gateway-collector.opentelemetry-operator-system.svc.cluster.local

# Agent Collector configuration (daemonset for node-level log collection)
agentCollector:
  # -- Enable Agent OpenTelemetryCollector Custom Resource
  enabled: false
  
  # -- Namespace for agent collector (should match OpenTelemetry Operator namespace)
  namespace: opentelemetry-operator-system
  
  # -- Full collector configuration (receivers, processors, exporters, service)
  # This should be a complete OTel Collector config YAML structure
  config: {}
  # Example config structure (commented out):
  # config:
  #   receivers:
  #     otlp:
  #       protocols:
  #         grpc:
  #           endpoint: 0.0.0.0:4317
  #   processors:
  #     batch: {}
  #   exporters:
  #     loadbalancing/gateway:
  #       resolver:
  #         dns:
  #           hostname: gateway-collector-headless.opentelemetry-operator-system.svc.cluster.local
  #           port: "4317"
  #   service:
  #     pipelines:
  #       traces:
  #         receivers: [otlp]
  #         processors: [batch]
  #         exporters: [loadbalancing/gateway]

# Gateway Collector configuration (deployment for centralized processing)
# This is the main TinyOlly collector - it receives from the agent collector,
# performs tail sampling, Envoy service name extraction, generates RED metrics,
# and forwards to TinyOlly's OTLP receiver.
gatewayCollector:
  # -- Enable Gateway OpenTelemetryCollector Custom Resource
  enabled: false
  
  # -- Namespace for gateway collector (should match OpenTelemetry Operator namespace)
  namespace: opentelemetry-operator-system
  
  # -- Number of replicas for gateway deployment
  replicas: 1
  
  # -- Pod annotations
  podAnnotations: {}
  
  # -- Resource limits and requests for the gateway collector
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 200m
      memory: 256Mi
  
  # -- Full collector configuration (receivers, processors, exporters, service)
  # This should be a complete OTel Collector config YAML structure
  config: {}
  # Example config structure (commented out):
  # config:
  #   receivers:
  #     otlp:
  #       protocols:
  #         grpc:
  #           endpoint: 0.0.0.0:4317
  #   processors:
  #     batch: {}
  #   exporters:
  #     otlp:
  #       endpoint: tinyolly-otlp-receiver.tinyolly.svc.cluster.local:4343
  #       tls:
  #         insecure: true
  #   service:
  #     pipelines:
  #       traces:
  #         receivers: [otlp]
  #         processors: [batch]
  #         exporters: [otlp]

# OpenTelemetry Instrumentation configuration
instrumentation:
  # -- Enable TinyOlly Instrumentation Custom Resource (managed by OpenTelemetry Operator)
  enabled: false
  
  # -- Name of the Instrumentation CR
  name: python-instrumentation
  
  # -- Namespace for the Instrumentation CR (defaults to release namespace if not set)
  namespace: opentelemetry-operator-system
  
  # -- Exporter configuration
  exporter:
    # -- Endpoint for the collector (OTel Operator creates service as agent-collector)
    endpoint: http://agent-collector.opentelemetry-operator-system.svc.cluster.local:4318
  
  # -- Propagators for context propagation
  propagators:
    - tracecontext
    - baggage
  
  # -- Resource attributes configuration
  resource:
    # -- Add Kubernetes UID attributes
    addK8sUIDAttributes: true
    # -- Additional resource attributes
    attributes:
      deployment.environment: "development"
  
  # Python auto-instrumentation configuration
  python:
    # Image for Python auto-instrumentation
    image:
      repository: ghcr.io/open-telemetry/opentelemetry-operator/autoinstrumentation-python
      tag: 0.60b0
    
    # -- Environment variables for Python instrumentation
    env:
      - name: OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED
        value: "true"
      - name: OTEL_PYTHON_LOGGING_INJECTION_ENABLED
        value: "true"
      - name: OTEL_PYTHON_LOG_LEVEL
        value: "INFO"
      - name: OTEL_PYTHON_LOG_CORRELATION
        value: "true"
      - name: OTEL_INSTRUMENTATION_HTTP_CAPTURE_HEADERS_SERVER_REQUEST
        value: "content-.*,x-.*"
      - name: OTEL_INSTRUMENTATION_HTTP_CAPTURE_HEADERS_SERVER_RESPONSE
        value: "content-.*,x-.*"
      - name: OTEL_PYTHON_EXCLUDED_URLS
        value: "/health,/metrics,ready"
    
    # -- Resource limits and requests for instrumentation init container
    resources:
      limits:
        cpu: 500m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 64Mi

# TinyOlly UI component
ui:
  # -- Number of replicas for UI
  replicaCount: 1
  
  image:
    # -- UI image repository
    repository: ghcr.io/ryanfaircloth/ui
    # -- UI image tag
    tag: latest
    # -- UI image pull policy (overrides global)
    pullPolicy: ""
  
  # -- Service account settings
  serviceAccount:
    # -- Create service account for UI
    create: true
    # -- Service account name (generated if not set)
    name: ""
    # -- Annotations for service account
    annotations: {}
  
  # -- Pod annotations
  podAnnotations: {}
  
  # -- Pod security context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  
  # -- Container security context
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
      - ALL
    readOnlyRootFilesystem: false
  
  service:
    # -- Service type
    type: ClusterIP
    # -- Service port
    port: 5002
    # -- Target port
    targetPort: 5002
    # -- Node port (if type is NodePort)
    nodePort: null
    # -- Service annotations
    annotations: {}
  
  # -- HTTPRoute configuration (Gateway API)
  httpRoute:
    # -- Enable HTTPRoute for UI
    enabled: false
    # -- Annotations for HTTPRoute
    annotations: {}
    # -- Gateway parentRefs (required for HTTPRoute)
    parentRefs:
      - name: management-gateway
        namespace: envoy-gateway-system
    # -- Hosts configuration
    hosts:
      - host: tinyolly.local.gd
        path: /
        pathType: PathPrefix
  
  # -- Resource limits and requests
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  # -- Liveness probe configuration
  livenessProbe:
    httpGet:
      path: /health
      port: 5002
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  # -- Readiness probe configuration
  readinessProbe:
    httpGet:
      path: /health
      port: 5002
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  
  # -- Environment variables
  env:
    - name: DEPLOYMENT_ENV
      value: kubernetes
    - name: OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED
      value: "true"
  
  # -- Additional environment variables (key-value pairs)
  extraEnv: {}
  
  # -- Additional volume mounts (core mounts are defined in template)
  volumeMounts: []
  
  # -- Additional volumes (core volumes are defined in template)
  volumes: []
  
  # -- Node selector
  nodeSelector: {}
  
  # -- Tolerations
  tolerations: []
  
  # -- Affinity
  affinity: {}

# TinyOlly OpAMP Server component
opampServer:
  # -- Number of replicas for OpAMP Server
  replicaCount: 1
  
  image:
    # -- OpAMP Server image repository
    repository: ghcr.io/ryanfaircloth/opamp-server
    # -- OpAMP Server image tag
    tag: latest
    # -- OpAMP Server image pull policy (overrides global)
    pullPolicy: ""
  
  # -- Service account settings
  serviceAccount:
    # -- Create service account for OpAMP Server
    create: true
    # -- Service account name (generated if not set)
    name: ""
    # -- Annotations for service account
    annotations: {}
  
  # -- Pod annotations
  podAnnotations: {}
  
  # -- Pod security context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  
  # -- Container security context
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
      - ALL
    readOnlyRootFilesystem: false
  
  service:
    # -- Service type
    type: ClusterIP
    # -- WebSocket port
    websocketPort: 4320
    # -- HTTP port
    httpPort: 4321
    # -- Service annotations
    annotations: {}
  
  # -- Resource limits and requests
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi
  
  # -- Liveness probe configuration
  livenessProbe:
    httpGet:
      path: /health
      port: 4321
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  # -- Readiness probe configuration
  readinessProbe:
    httpGet:
      path: /health
      port: 4321
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  
  # -- Environment variables
  env:
    - name: OPAMP_PORT
      value: "4320"
    - name: HTTP_PORT
      value: "4321"
    - name: COLLECTOR_CONFIG_PATH
      value: /etc/otel-collector-config.yaml
  
  # -- Additional environment variables
  extraEnv: {}
  
  # -- Additional volume mounts (core mounts are defined in template)
  volumeMounts: []
  
  # -- Additional volumes (core volumes are defined in template)
  volumes: []
  
  # -- Node selector
  nodeSelector: {}
  
  # -- Tolerations
  tolerations: []
  
  # -- Affinity
  affinity: {}

# TinyOlly OTLP Receiver component
otlpReceiver:
  # -- Number of replicas for OTLP Receiver
  replicaCount: 1
  
  image:
    # -- OTLP Receiver image repository
    repository: ghcr.io/ryanfaircloth/otlp-receiver
    # -- OTLP Receiver image tag
    tag: latest
    # -- OTLP Receiver image pull policy (overrides global)
    pullPolicy: ""
  
  # -- Service account settings
  serviceAccount:
    # -- Create service account for OTLP Receiver
    create: true
    # -- Service account name (generated if not set)
    name: ""
    # -- Annotations for service account
    annotations: {}
  
  # -- Pod annotations
  podAnnotations: {}
  
  # -- Pod security context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  
  # -- Container security context
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
      - ALL
    readOnlyRootFilesystem: false
  
  service:
    # -- Service type
    type: ClusterIP
    # -- Service port
    port: 4343
    # -- Target port
    targetPort: 4343
    # -- Service annotations
    annotations: {}
  
  # -- Resource limits and requests
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  # -- Liveness probe configuration
  livenessProbe:
    tcpSocket:
      port: 4343
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  # -- Readiness probe configuration
  readinessProbe:
    tcpSocket:
      port: 4343
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  
  # -- Environment variables
  env:
    - name: PORT
      value: "4343"
    - name: OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED
      value: "true"
  
  # -- Additional environment variables
  extraEnv: {}
  
  # -- Node selector
  nodeSelector: {}
  
  # -- Tolerations
  tolerations: []
  
  # -- Affinity
  affinity: {}
