global:
  namespace: ollyscale
replicaCount: 1
image:
  pullPolicy: Always
  pullSecrets: []
commonLabels: {}
commonAnnotations: {}
redis:
  host: ollyscale-redis
  port: 6379
otelCollector:
  enabled: false
  serviceName: gateway-collector
  port: 4318
agentCollector:
  enabled: true
  namespace: ollyscale
  config:
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:4317
          http:
            endpoint: 0.0.0.0:4318
    processors:
      batch:
        timeout: 5s
        send_batch_size: 256
    exporters:
      loadbalancing/gateway:
        resolver:
          dns:
            hostname: gateway-collector-headless.ollyscale.svc.cluster.local
            port: '4317'
        protocol:
          otlp:
            tls:
              insecure: true
    service:
      pipelines:
        traces:
          receivers:
            - otlp
          processors:
            - batch
          exporters:
            - loadbalancing/gateway
        metrics:
          receivers:
            - otlp
          processors:
            - batch
          exporters:
            - loadbalancing/gateway
        logs:
          receivers:
            - otlp
          processors:
            - batch
          exporters:
            - loadbalancing/gateway
gatewayCollector:
  enabled: true
  namespace: ollyscale
  replicas: 1
  podAnnotations: {}
  resources:
    limits:
      memory: 1Gi
    requests:
      cpu: 200m
      memory: 512Mi
  config:
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:4317
          http:
            endpoint: 0.0.0.0:4318
    processors:
      batch:
        timeout: 5s
        send_batch_size: 256
      tail_sampling:
        decision_wait: 10s
        num_traces: 50000
        expected_new_traces_per_sec: 100
        policies:
          - name: errors
            type: status_code
            status_code:
              status_codes:
                - ERROR
          - name: http-errors
            type: string_attribute
            string_attribute:
              key: http.status_code
              values:
                - 4[0-9]{2}
                - 5[0-9]{2}
              enabled_regex_matching: true
          - name: keep-demos
            type: string_attribute
            string_attribute:
              key: service.name
              values:
                - demo-.*
                - otel-demo-.*
                - ai-agent.*
              enabled_regex_matching: true
          - name: keep-non-ollyscale
            type: and
            and:
              and_sub_policy:
                - name: not-ollyscale
                  type: string_attribute
                  string_attribute:
                    key: service.name
                    values:
                      - ollyscale-.*
                    enabled_regex_matching: true
                    invert_match: true
          - name: sample-ollyscale-success
            type: and
            and:
              and_sub_policy:
                - name: ollyscale-services
                  type: string_attribute
                  string_attribute:
                    key: service.name
                    values:
                      - ollyscale-.*
                    enabled_regex_matching: true
                - name: not-error
                  type: status_code
                  status_code:
                    status_codes:
                      - OK
                      - UNSET
                - name: probabilistic
                  type: probabilistic
                  probabilistic:
                    sampling_percentage: 5
    exporters:
      otlp/to:
        endpoint: ollyscale-otlp-receiver.ollyscale.svc.cluster.local:4343
        tls:
          insecure: true
    service:
      pipelines:
        traces:
          receivers:
            - otlp
          processors:
            - tail_sampling
            - batch
          exporters:
            - otlp/to
        metrics:
          receivers:
            - otlp
          processors:
            - batch
          exporters:
            - otlp/to
        logs:
          receivers:
            - otlp
          processors:
            - batch
          exporters:
            - otlp/to
instrumentation:
  enabled: true
  selfObservability: true
  name: python-instrumentation
  exporter:
    endpoint: http://agent-collector.ollyscale.svc.cluster.local:4318
  propagators:
    - tracecontext
    - baggage
  sampler:
    type: always_on
  resource:
    addK8sUIDAttributes: true
    attributes:
      deployment.environment: development
  python:
    image:
      repository: ghcr.io/open-telemetry/opentelemetry-operator/autoinstrumentation-python
      tag: 0.60b0
    env:
      - name: OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED
        value: 'true'
      - name: OTEL_PYTHON_LOGGING_INJECTION_ENABLED
        value: 'true'
      - name: OTEL_PYTHON_LOG_LEVEL
        value: INFO
      - name: OTEL_PYTHON_LOG_CORRELATION
        value: 'true'
      - name: OTEL_INSTRUMENTATION_HTTP_CAPTURE_HEADERS_SERVER_REQUEST
        value: content-.*,x-.*
      - name: OTEL_INSTRUMENTATION_HTTP_CAPTURE_HEADERS_SERVER_RESPONSE
        value: content-.*,x-.*
      - name: OTEL_PYTHON_EXCLUDED_URLS
        value: /health,/metrics,ready,PING
    resources:
      limits:
        cpu: 500m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 64Mi
  go:
    image:
      repository: ghcr.io/open-telemetry/opentelemetry-operator/autoinstrumentation-go
      tag: v0.15.0-alpha
    env:
      - name: OTEL_GO_AUTO_TARGET_EXE
        value: /app/ollyscale-opamp-server
      - name: OTEL_SERVICE_NAME
        value: ollyscale-opamp-server
      - name: OTEL_EXPORTER_OTLP_ENDPOINT
        value: http://agent-collector.ollyscale.svc.cluster.local:4318
    resources:
      limits:
        cpu: 500m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 64Mi
ebpfAgent:
  enabled: false
  namespace: ollyscale
  image:
    repository: docker.io/otel/ebpf-instrument
    tag: v0.4.1
    pullPolicy: Always
  podAnnotations: {}
  podSecurityContext:
    hostPID: true
  securityContext:
    privileged: true
    runAsUser: 0
    readOnlyRootFilesystem: false
  resources:
    limits:
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  config:
    otlpEndpoint: http://gateway-collector.ollyscale.svc.cluster.local:4317
    openPorts: '5000'
    serviceName: ebpf-demo
  nodeSelector: {}
  tolerations: []
  affinity: {}
frontend:
  replicaCount: 1
  image:
    repository: ghcr.io/ryanfaircloth/ollyscale
    tag: 0.1.2
    pullPolicy: ''
  serviceAccount:
    create: true
    name: ''
    annotations: {}
  podAnnotations: {}
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
  service:
    type: ClusterIP
    port: 5002
    targetPort: 5002
    nodePort: null
    annotations: {}
  httpRoute:
    enabled: false
  resources:
    limits:
      memory: 1Gi
    requests:
      cpu: 200m
      memory: 256Mi
  livenessProbe:
    httpGet:
      path: /health
      port: 5002
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /health
      port: 5002
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  env:
    - name: MODE
      value: ui
    - name: DEPLOYMENT_ENV
      value: kubernetes
    - name: OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED
      value: 'true'
webui:
  replicaCount: 1
  image:
    repository: ghcr.io/ryanfaircloth/ollyscale/ollyscale-ui
    tag: 0.1.2
    pullPolicy: ''
  serviceAccount:
    create: true
    name: ''
    annotations: {}
  podAnnotations: {}
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 101
    fsGroup: 101
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
    nodePort: null
    annotations: {}
  httpRoute:
    enabled: true
    annotations: {}
    parentRefs:
      - name: management-gateway
        namespace: envoy-gateway-system
    hosts:
      - host: ollyscale.local.gd
        path: /
        pathType: PathPrefix
  resources:
    limits:
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi
  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 2
    failureThreshold: 3
  env: []
  extraEnv: {}
  volumeMounts: []
  volumes: []
  nodeSelector: {}
  tolerations: []
  affinity: {}
opampServer:
  replicaCount: 1
  image:
    repository: ghcr.io/ryanfaircloth/ollyscale/opamp-server
    tag: 0.1.2
    pullPolicy: ''
  serviceAccount:
    create: true
    name: ''
    annotations: {}
  podAnnotations: {}
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
  service:
    type: ClusterIP
    websocketPort: 4320
    httpPort: 4321
    annotations: {}
  resources:
    limits: {}
    requests:
      cpu: 50m
      memory: 128Mi
  livenessProbe:
    httpGet:
      path: /health
      port: 4321
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /health
      port: 4321
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  env:
    - name: OPAMP_PORT
      value: '4320'
    - name: HTTP_PORT
      value: '4321'
    - name: COLLECTOR_CONFIG_PATH
      value: /etc/otel-collector-config.yaml
  extraEnv: {}
  volumeMounts: []
  volumes: []
  nodeSelector: {}
  tolerations: []
  affinity: {}
otlpReceiver:
  replicaCount: 1
  image:
    repository: ghcr.io/ryanfaircloth/ollyscale/ollyscale
    tag: 0.1.2
    pullPolicy: ''
  serviceAccount:
    create: true
    name: ''
    annotations: {}
  podAnnotations: {}
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
  service:
    type: ClusterIP
    port: 4343
    targetPort: 4343
    annotations: {}
  resources:
    limits:
      memory: 512Mi
    requests:
      cpu: 200m
      memory: 256Mi
  livenessProbe:
    tcpSocket:
      port: 4343
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    tcpSocket:
      port: 4343
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  env:
    - name: MODE
      value: receiver
    - name: PORT
      value: '4343'
    - name: OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED
      value: 'true'
  extraEnv: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
